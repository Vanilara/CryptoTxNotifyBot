import pytest

from src.core.networks import Networks
from src.services.transaction_service import TransactionService


test_data_trc = [
    {
        "blockHash": "0x000000000405eafe10e0ebc42fd678831a01ec316de62f85f54abc7a396e95eb",
        "blockNumber": "0x405eafe",
        "contractAddress": "",
        "cumulativeGasUsed": "0x849523",
        "effectiveGasPrice": "0xd2",
        "from": "0x23bc1e59fa8b4c28eb6ec2d00b52f12614eb370a",
        "gasUsed": "0xfb1d",
        "logs": [
            {
                "address": "0xa614f803b6fd780986a42c78ec9c7f77e6ded13c",
                "blockHash": "0x000000000405eafe10e0ebc42fd678831a01ec316de62f85f54abc7a396e95eb",
                "blockNumber": "0x405eafe",
                "data": "0x000000000000000000000000000000000000000000000000000000001730e3c0",
                "logIndex": "0x6e",
                "removed": False,
                "topics": [
                    "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
                    "0x00000000000000000000000023bc1e59fa8b4c28eb6ec2d00b52f12614eb370a",
                    "0x000000000000000000000000a148e5a8f564fdbafd5025561f265a9e8fa26602",
                ],
                "transactionHash": "0x9cb495295a2a242e76106a28ba6320f34106249e5fdead2c52bfeb396272377d",
                "transactionIndex": "0x193",
            }
        ],
        "logsBloom": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
        "status": "0x1",
        "to": "0xa614f803b6fd780986a42c78ec9c7f77e6ded13c",
        "transactionHash": "0x9cb495295a2a242e76106a28ba6320f34106249e5fdead2c52bfeb396272377d",
        "transactionIndex": "0x193",
        "type": "0x0",
    }
]
test_data_erc = [
    {
        "blockHash": "0x996fa6f6422de04854dca17af994c4ae8e82e463c4c7c4276532bad5736cc6c0",
        "blockNumber": "0x1453c4a",
        "contractAddress": "",
        "cumulativeGasUsed": "0x1b9cf9",
        "effectiveGasPrice": "0x28632c222",
        "from": "0xae2fc483527b8ef99eb5d9b44875f005ba1fae13",
        "gasUsed": "0x30963",
        "logs": [
            {
                "address": "0xdac17f958d2ee523a2206206994597c13d831ec7",
                "blockHash": "0x996fa6f6422de04854dca17af994c4ae8e82e463c4c7c4276532bad5736cc6c0",
                "blockNumber": "0x1453c4a",
                "data": "0x00000000000000000000000000000000000000000000000000000000686043f5",
                "logIndex": "0x39",
                "removed": False,
                "topics": [
                    "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
                    "0x0000000000000000000000001f2f10d1c40777ae1da742455c65828ff36df387",
                    "0x0000000000000000000000008dacbad3b875f95497a9497dcf177692e87a6f90",
                ],
                "transactionHash": "0x1ec8acdd1ffc9b4eaa4c9198cd0c3341b3c122ca97b881d3ad5f38630c5cf340",
                "transactionIndex": "0x7",
            },
            {
                "address": "0x5ac34c53a04b9aaa0bf047e7291fb4e8a48f2a18",
                "blockHash": "0x996fa6f6422de04854dca17af994c4ae8e82e463c4c7c4276532bad5736cc6c0",
                "blockNumber": "0x1453c4a",
                "data": "0x000000000000000000000000000000000000000000002361402e000000000000",
                "logIndex": "0x3a",
                "removed": False,
                "topics": [
                    "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
                    "0x0000000000000000000000008dacbad3b875f95497a9497dcf177692e87a6f90",
                    "0x0000000000000000000000001f2f10d1c40777ae1da742455c65828ff36df387",
                ],
                "transactionHash": "0x1ec8acdd1ffc9b4eaa4c9198cd0c3341b3c122ca97b881d3ad5f38630c5cf340",
                "transactionIndex": "0x7",
            },
            {
                "address": "0x8dacbad3b875f95497a9497dcf177692e87a6f90",
                "blockHash": "0x996fa6f6422de04854dca17af994c4ae8e82e463c4c7c4276532bad5736cc6c0",
                "blockNumber": "0x1453c4a",
                "data": "0x0000000000000000000000000000000000000000000e613feaef5e07f84239010000000000000000000000000000000000000000000000000000002ab40a8108",
                "logIndex": "0x3b",
                "removed": False,
                "topics": [
                    "0x1c411e9a96e071241c2f21f7726b17ae89e3cab4c78be50e062b03a9fffbbad1"
                ],
                "transactionHash": "0x1ec8acdd1ffc9b4eaa4c9198cd0c3341b3c122ca97b881d3ad5f38630c5cf340",
                "transactionIndex": "0x7",
            },
            {
                "address": "0x8dacbad3b875f95497a9497dcf177692e87a6f90",
                "blockHash": "0x996fa6f6422de04854dca17af994c4ae8e82e463c4c7c4276532bad5736cc6c0",
                "blockNumber": "0x1453c4a",
                "data": "0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000686043f5000000000000000000000000000000000000000000002361402e0000000000000000000000000000000000000000000000000000000000000000000000000000",
                "logIndex": "0x3c",
                "removed": False,
                "topics": [
                    "0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822",
                    "0x0000000000000000000000001f2f10d1c40777ae1da742455c65828ff36df387",
                    "0x0000000000000000000000001f2f10d1c40777ae1da742455c65828ff36df387",
                ],
                "transactionHash": "0x1ec8acdd1ffc9b4eaa4c9198cd0c3341b3c122ca97b881d3ad5f38630c5cf340",
                "transactionIndex": "0x7",
            },
            {
                "address": "0x960692640ac4986ffce41620b7e3aa03cf1a0e8f",
                "blockHash": "0x996fa6f6422de04854dca17af994c4ae8e82e463c4c7c4276532bad5736cc6c0",
                "blockNumber": "0x1453c4a",
                "data": "0x000000000000000000000000000000000000000000000030b3b7fed885b075a3",
                "logIndex": "0x3d",
                "removed": False,
                "topics": [
                    "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
                    "0x0000000000000000000000001aff94bb420361109097916970b8bfb7ab5ac3a6",
                    "0x0000000000000000000000001f2f10d1c40777ae1da742455c65828ff36df387",
                ],
                "transactionHash": "0x1ec8acdd1ffc9b4eaa4c9198cd0c3341b3c122ca97b881d3ad5f38630c5cf340",
                "transactionIndex": "0x7",
            },
            {
                "address": "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",
                "blockHash": "0x996fa6f6422de04854dca17af994c4ae8e82e463c4c7c4276532bad5736cc6c0",
                "blockNumber": "0x1453c4a",
                "data": "0x000000000000000000000000000000000000000000000000004b2adddb000000",
                "logIndex": "0x3e",
                "removed": False,
                "topics": [
                    "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
                    "0x0000000000000000000000001f2f10d1c40777ae1da742455c65828ff36df387",
                    "0x0000000000000000000000001aff94bb420361109097916970b8bfb7ab5ac3a6",
                ],
                "transactionHash": "0x1ec8acdd1ffc9b4eaa4c9198cd0c3341b3c122ca97b881d3ad5f38630c5cf340",
                "transactionIndex": "0x7",
            },
            {
                "address": "0x1aff94bb420361109097916970b8bfb7ab5ac3a6",
                "blockHash": "0x996fa6f6422de04854dca17af994c4ae8e82e463c4c7c4276532bad5736cc6c0",
                "blockNumber": "0x1453c4a",
                "data": "0xffffffffffffffffffffffffffffffffffffffffffffffcf4c4801277a4f8a5d000000000000000000000000000000000000000000000000004b2adddb0000000000000000000000000000000000000000000000013df84943c778c407dba89700000000000000000000000000000000000000000000005bfee62f4581332d50fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe5fb2",
                "logIndex": "0x3f",
                "removed": False,
                "topics": [
                    "0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67",
                    "0x0000000000000000000000001f2f10d1c40777ae1da742455c65828ff36df387",
                    "0x0000000000000000000000001f2f10d1c40777ae1da742455c65828ff36df387",
                ],
                "transactionHash": "0x1ec8acdd1ffc9b4eaa4c9198cd0c3341b3c122ca97b881d3ad5f38630c5cf340",
                "transactionIndex": "0x7",
            },
        ],
        "logsBloom": "0x002000000000000000000000800000004000000000000000000000000000000000000000000000000000000000000100020000000800200000000000000000000000000000000008000010080010002000080000000000000000000400000000000000000000000000000000000000001000000000000000000000100008000080004000000000000000000000000000004000000000000800000040001000000400000000400000000020800000000000000000000000000000000000000000000000020000000010200200000000000000002000000010000000000a0000000000202000000000000010000000000000000000000000000000000000000100",
        "status": "0x1",
        "to": "0x1f2f10d1c40777ae1da742455c65828ff36df387",
        "transactionHash": "0x1ec8acdd1ffc9b4eaa4c9198cd0c3341b3c122ca97b881d3ad5f38630c5cf340",
        "transactionIndex": "0x7",
        "type": "0x2",
    },
    {
        "blockHash": "0x996fa6f6422de04854dca17af994c4ae8e82e463c4c7c4276532bad5736cc6c0",
        "blockNumber": "0x1453c4a",
        "contractAddress": "",
        "cumulativeGasUsed": "0x2523dc",
        "effectiveGasPrice": "0x3d5dcd9f8",
        "from": "0xae2fc483527b8ef99eb5d9b44875f005ba1fae13",
        "gasUsed": "0x2d611",
        "logs": [
            {
                "address": "0x5ac34c53a04b9aaa0bf047e7291fb4e8a48f2a18",
                "blockHash": "0x996fa6f6422de04854dca17af994c4ae8e82e463c4c7c4276532bad5736cc6c0",
                "blockNumber": "0x1453c4a",
                "data": "0x000000000000000000000000000000000000000000002361402d000000000000",
                "logIndex": "0x4f",
                "removed": False,
                "topics": [
                    "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
                    "0x0000000000000000000000001f2f10d1c40777ae1da742455c65828ff36df387",
                    "0x0000000000000000000000008dacbad3b875f95497a9497dcf177692e87a6f90",
                ],
                "transactionHash": "0x82b6042e03e8bba26cf7dda76b6f060559eedc6288b3465b3ae6ce401c3e7755",
                "transactionIndex": "0xa",
            },
            {
                "address": "0xdac17f958d2ee523a2206206994597c13d831ec7",
                "blockHash": "0x996fa6f6422de04854dca17af994c4ae8e82e463c4c7c4276532bad5736cc6c0",
                "blockNumber": "0x1453c4a",
                "data": "0x0000000000000000000000000000000000000000000000000000000068f5b58d",
                "logIndex": "0x50",
                "removed": False,
                "topics": [
                    "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
                    "0x0000000000000000000000008dacbad3b875f95497a9497dcf177692e87a6f90",
                    "0x0000000000000000000000001f2f10d1c40777ae1da742455c65828ff36df387",
                ],
                "transactionHash": "0x82b6042e03e8bba26cf7dda76b6f060559eedc6288b3465b3ae6ce401c3e7755",
                "transactionIndex": "0xa",
            },
            {
                "address": "0x8dacbad3b875f95497a9497dcf177692e87a6f90",
                "blockHash": "0x996fa6f6422de04854dca17af994c4ae8e82e463c4c7c4276532bad5736cc6c0",
                "blockNumber": "0x1453c4a",
                "data": "0x0000000000000000000000000000000000000000000e6f669ae1e9db0d0ac3710000000000000000000000000000000000000000000000000000002a8aae061f",
                "logIndex": "0x51",
                "removed": False,
                "topics": [
                    "0x1c411e9a96e071241c2f21f7726b17ae89e3cab4c78be50e062b03a9fffbbad1"
                ],
                "transactionHash": "0x82b6042e03e8bba26cf7dda76b6f060559eedc6288b3465b3ae6ce401c3e7755",
                "transactionIndex": "0xa",
            },
            {
                "address": "0x8dacbad3b875f95497a9497dcf177692e87a6f90",
                "blockHash": "0x996fa6f6422de04854dca17af994c4ae8e82e463c4c7c4276532bad5736cc6c0",
                "blockNumber": "0x1453c4a",
                "data": "0x000000000000000000000000000000000000000000002361402d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000068f5b58d",
                "logIndex": "0x52",
                "removed": False,
                "topics": [
                    "0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822",
                    "0x0000000000000000000000001f2f10d1c40777ae1da742455c65828ff36df387",
                    "0x0000000000000000000000001f2f10d1c40777ae1da742455c65828ff36df387",
                ],
                "transactionHash": "0x82b6042e03e8bba26cf7dda76b6f060559eedc6288b3465b3ae6ce401c3e7755",
                "transactionIndex": "0xa",
            },
            {
                "address": "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",
                "blockHash": "0x996fa6f6422de04854dca17af994c4ae8e82e463c4c7c4276532bad5736cc6c0",
                "blockNumber": "0x1453c4a",
                "data": "0x000000000000000000000000000000000000000000000000005406a7d9000001",
                "logIndex": "0x53",
                "removed": False,
                "topics": [
                    "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
                    "0x0000000000000000000000001aff94bb420361109097916970b8bfb7ab5ac3a6",
                    "0x0000000000000000000000001f2f10d1c40777ae1da742455c65828ff36df387",
                ],
                "transactionHash": "0x82b6042e03e8bba26cf7dda76b6f060559eedc6288b3465b3ae6ce401c3e7755",
                "transactionIndex": "0xa",
            },
            {
                "address": "0x960692640ac4986ffce41620b7e3aa03cf1a0e8f",
                "blockHash": "0x996fa6f6422de04854dca17af994c4ae8e82e463c4c7c4276532bad5736cc6c0",
                "blockNumber": "0x1453c4a",
                "data": "0x000000000000000000000000000000000000000000000030b3b756e1f88c4260",
                "logIndex": "0x54",
                "removed": False,
                "topics": [
                    "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
                    "0x0000000000000000000000001f2f10d1c40777ae1da742455c65828ff36df387",
                    "0x0000000000000000000000001aff94bb420361109097916970b8bfb7ab5ac3a6",
                ],
                "transactionHash": "0x82b6042e03e8bba26cf7dda76b6f060559eedc6288b3465b3ae6ce401c3e7755",
                "transactionIndex": "0xa",
            },
            {
                "address": "0x1aff94bb420361109097916970b8bfb7ab5ac3a6",
                "blockHash": "0x996fa6f6422de04854dca17af994c4ae8e82e463c4c7c4276532bad5736cc6c0",
                "blockNumber": "0x1453c4a",
                "data": "0x000000000000000000000000000000000000000000000030b3b756e1f88c4260ffffffffffffffffffffffffffffffffffffffffffffffffffabf95826ffffff000000000000000000000000000000000000000001504ec57b24b59c8d30e56200000000000000000000000000000000000000000000005bfee62f4581332d50fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe6414",
                "logIndex": "0x55",
                "removed": False,
                "topics": [
                    "0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67",
                    "0x0000000000000000000000001f2f10d1c40777ae1da742455c65828ff36df387",
                    "0x0000000000000000000000001f2f10d1c40777ae1da742455c65828ff36df387",
                ],
                "transactionHash": "0x82b6042e03e8bba26cf7dda76b6f060559eedc6288b3465b3ae6ce401c3e7755",
                "transactionIndex": "0xa",
            },
        ],
        "logsBloom": "0x002000000000000000000000800000004000000000000000000000000000000000000000000000000000000000000100020000000800200000000000000000000000000000000008000010080010002000080000000000000000000400000000000000000000000000000000000000001000000000000000000000100008000080004000000000000000000000000000004000000000000800000040001000000400000000400000000020800000000000000000000000000000000000000000000000020000000010200200000000000000002000000010000000000a0000000000202000000000000010000000000000000000000000000000000000000100",
        "status": "0x1",
        "to": "0x1f2f10d1c40777ae1da742455c65828ff36df387",
        "transactionHash": "0x82b6042e03e8bba26cf7dda76b6f060559eedc6288b3465b3ae6ce401c3e7755",
        "transactionIndex": "0xa",
        "type": "0x2",
    },
]

async def test_transaction(unit_of_work):
    for row in test_data_trc:
        assert len(await TransactionService(unit_of_work).handle_transactions(row)) == 1
